(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03d32dc5"],{"1aea":function(t,e,n){"use strict";var s=n("3971"),o=n.n(s);o.a},"212f":function(t,e,n){"use strict";var s=n("934c"),o=n.n(s);o.a},3971:function(t,e,n){},6273:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"media-detail-container"},[n("div",{staticClass:"player-container"},[n("div",{ref:"dplayer",staticClass:"setting-player"}),n("el-form",{ref:"form",staticStyle:{"margin-top":"24px"},attrs:{model:t.sizeForm,"label-width":"150px",size:"mini"}},[n("el-form-item",{attrs:{label:"RTC_ID"}},[n("el-input",{attrs:{disabled:""},model:{value:t.rtcid,callback:function(e){t.rtcid=e},expression:"rtcid"}})],1),n("el-form-item",{attrs:{label:"直播间名称"}},[n("el-input",{model:{value:t.roomName,callback:function(e){t.roomName=e},expression:"roomName"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"danger"},on:{click:t.toggleRoomStatus}},[t._v("\n          "+t._s(2===t.setting.status?"开始直播":"停止直播")+"\n        ")]),n("el-button",{attrs:{type:"primary"},on:{click:t.updateRoomInfo}},[t._v("\n          保存设置\n        ")])],1)],1)],1),n("div",{staticClass:"chat-container"},[n("chat-panel",{attrs:{username:t.user.username,id:t.setting.id}})],1)])},o=[],i=(n("28a5"),n("6b54"),n("cebc")),a=n("2f62"),c=n("f7a5"),r=n.n(c),l=n("a0bc"),u=n.n(l),m=(n("ba56"),n("eccb"),n("657d")),d={components:{ChatPanel:m["a"]},computed:Object(i["a"])({},Object(a["b"])({user:function(t){return t.user.user},setting:function(t){return t.live.setting},loading:function(t){return t.media.loading}})),mounted:function(){var t=this;new r.a({container:t.$refs.dplayer,screenshot:!0,video:{url:""}});this.roomName=this.setting.room_name;var e=(+new Date).toString(36)+"_"+Math.random().toString().split(".")[1];this.rtcid=""===this.setting.stream?e:this.setting.stream;var n=new u.a(this.rtcid,{host:"localhost",port:9e3,path:"/"});navigator.getUserMedia({audio:!1,video:{width:1e3,height:400}},function(t){window.stream=t,document.getElementsByTagName("video")[0].srcObject=window.stream,console.log(document.getElementsByTagName("video")[0],document.getElementsByTagName("video")[0].srcObject,window.stream)},function(){}),n.on("connection",function(t){t.on("data",function(t){var e=n.call(t,window.stream);e.on("close",function(){})})})},data:function(){return{rtcid:"",roomName:""}},watch:{setting:function(t){this.roomName=t.room_name;var e=(+new Date).toString(36)+"_"+Math.random().toString().split(".")[1];this.rtcid=""===t.stream?e:t.stream;var n=new u.a(this.rtcid,{host:"localhost",port:9e3,path:"/"});navigator.getUserMedia({audio:!1,video:{width:1e3,height:400}},function(t){window.stream=t,document.getElementsByTagName("video")[0].srcObject=window.stream,console.log(document.getElementsByTagName("video")[0],document.getElementsByTagName("video")[0].srcObject,window.stream)},function(){}),n.on("connection",function(t){t.on("data",function(t){var e=n.call(t,window.stream);e.on("close",function(){})})}),console.log("test1",this.rtcid)}},methods:{updateRoomInfo:function(){this.$store.dispatch("live/update",{name:this.roomName,stream:this.rtcid,id:this.setting.id})},toggleRoomStatus:function(){2===this.setting.status&&""===this.setting.id?this.$store.dispatch("live/add",{owner:this.user.username,name:this.roomName,type:"webrtc",stream:this.rtcid}):this.$store.dispatch("live/delete",{id:this.setting.id})}}},h=d,g=(n("1aea"),n("2877")),f=Object(g["a"])(h,s,o,!1,null,null,null);f.options.__file="webrtc.vue";e["default"]=f.exports},"657d":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-panel"},[n("div",{staticClass:"message-list"},t._l(t.msgList,function(e,s){return n("div",{key:s,staticClass:"message"},["sys"===e.type?n("div",{staticClass:"sys-message"},[t._v("\n        "+t._s(e.content)+"\n      ")]):n("div",{class:"my"===e.type?"my-message":"normal-message"},["my"!==e.type?n("span",{staticClass:"normal-message-user"},[t._v("\n          "+t._s(e.user)+":\n        ")]):t._e(),n("span",{staticClass:"message-content"},[t._v("\n          "+t._s(e.content)+"\n        ")])])])}),0),n("div",{staticClass:"user-control"},[n("el-input",{attrs:{placeholder:"在此输入消息"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.emitMsg(e):null}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)])},o=[],i=n("cebc"),a=(n("c5f6"),n("cadf"),n("551c"),n("097d"),n("8055")),c=n.n(a),r=n("2f62"),l={},u=new c.a("http://localhost:3002",l),m={data:function(){return{content:"",socket:u,msgList:[],userList:[],userCount:0}},props:{username:{type:String,default:""},id:{type:Number,default:""}},updated:function(){this.scrollToBottom()},computed:Object(i["a"])({},Object(r["b"])({setting:function(t){return t.live.setting}})),methods:{emitMsg:function(){this.socket.send(this.content),this.content=""},scrollToBottom:function(){var t=this;this.$nextTick(function(){var e=t.$el.querySelector(".message-list");e.scrollTop=e.scrollHeight})},sendMessage:function(){this.socket.send(this.content),this.content=""},leaveRoom:function(){this.socket.emit("leave")}},mounted:function(){this.scrollToBottom();var t=this;console.log(this.socket),this.socket.on("connect",function(){console.log("test",t.username,t.setting.id),t.socket.emit("join",t.username,t.setting.id)}),this.socket.on("msg",function(e,n){e===t.username?t.msgList.push({user:e,content:n,type:"my"}):t.msgList.push({user:e,content:n,type:"msg"})}),this.socket.on("sys",function(e,n){t.msgList.push({user:"",content:e,type:"sys"}),t.userCount=n.length,t.userList=n,console.log("test",n)})}},d=m,h=(n("212f"),n("2877")),g=Object(h["a"])(d,s,o,!1,null,null,null);g.options.__file="rtcChat.vue";e["a"]=g.exports},"934c":function(t,e,n){}}]);